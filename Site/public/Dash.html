<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatorio de Sobrevivente</title>
    <link rel="stylesheet" href="./Css/Dash.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="exibir()">
  <div class="BarraL">
  <h2>Navegação</h2>
  <a href="index.html"><button>Início</button></a><br><br>
  <a href="Quiz.html"><button>Jogar Quiz</button></a>
</div>
  <div class="dashboard">
    <h2>Bem-vindo, Sobrevivente!</h2>
    <div class="KPIs">
  <div class="CaixaKpi">
    <h5>Quantidade de Tentativas</h5>
    <span id="tentativasSpan"></span>
  </div>
  <div class="CaixaKpi">
    <h5>Melhor Pontuação</h5>
    <span id="pontuacaoSpan"></span>
  </div>
  <div class="CaixaKpi">
    <h5>Última Tentativa</h5>
    <span id="ultimaTentativaSpan"></span>
  </div>
</div>

    </div>
    <div class="Graficos">
      <canvas id="graficoBarras"></canvas>
      <canvas id="graficoPizza"></canvas>
    </div>


  <script src="dashboard.js"></script>

</body>
</html>
<script>
function exibir() {
  const idUsuario = sessionStorage.getItem('ID_USUARIO');

  if (!idUsuario) {
    alert("Usuário não logado!");
    window.location.href = "index.html";
    return;
  }

  fetch(`/dashboard/tentativas/${idUsuario}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("tentativasSpan").innerText = data.tentativas;
    });

  fetch(`/dashboard/pontuacao/${idUsuario}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("pontuacaoSpan").innerText = data.maiorPontuacao;
    });


  fetch(`/dashboard/ultima/${idUsuario}`)
    .then(res => res.json())
    .then(data => {
     /* var dtAno = data.ultimaTentativa.slice(0,3);
      var dtMes = data.ultimaTentativa.slice(5,6);
      var dtDia = data.ultimaTentativa.slice(8,9);
      var dtHora = data.ultimaTentativa.slice(11,18);
      var dtTratada = `${dtDia} ${dtMes} ${dtAno} ${dtHora}`;*/
      document.getElementById("ultimaTentativaSpan").innerText = data.ultimaTentativa;
    });


fetch(`/dashboard/tentativas/${idUsuario}`)
  .then(res => res.json())
  .then(data => {
    document.getElementById("tentativasSpan").innerText = data.tentativas;

    fetch(`/dashboard/pontuacao/${idUsuario}`)
      .then(res => res.json())
      .then(pontuacaoData => {
        document.getElementById("pontuacaoSpan").innerText = pontuacaoData.maiorPontuacao;

        const ctxBarra = document.getElementById('graficoBarras').getContext('2d');
        new Chart(ctxBarra, {
          type: 'bar',
          data: {
            labels: ['Tentativas', 'Melhor Pontuação'],
            datasets: [{
              label: 'Desempenho',
              backgroundColor: ['#3498db', '#2ecc71'],
              data: [data.tentativas, pontuacaoData.maiorPontuacao]
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      });
  });


 fetch(`/dashboard/graficoPizza/${idUsuario}`)
  .then(res => res.json())
  .then(data => {
    const ctxPizza = document.getElementById('graficoPizza').getContext('2d');
    const graficoPizza = new Chart(ctxPizza, {
      type: 'pie',
      data: {
        labels: ['Acertos', 'Erros'],
        datasets: [{
          label: 'Última Tentativa',
          data: [data.acertos, data.erros],
          backgroundColor: ['#2ecc71', '#e74c3c']
        }]
      }
    });
  });

}

</script>